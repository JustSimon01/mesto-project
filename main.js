(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{id:()=>U});var e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"},o=document.querySelector(".popup__image-container").closest(".popup"),n=(o.querySelector(".popup__close-button"),document.querySelectorAll(".popup__close-button")),r=o.querySelector(".popup__image"),c=o.querySelector(".popup__image-subtitle"),a=document.querySelector(".cards"),u=document.querySelector("#card").content,i=document.querySelector("#cardUpload"),s=i.querySelector("#card-name-input"),l=i.querySelector("#link-input"),d=i.closest(".popup"),p=i.querySelector(e.submitButtonSelector),f=document.querySelector(".profile__avatar"),m=document.querySelector(".profile__avatar-edit"),v=document.querySelector("#change-avatar").closest(".popup"),_=v.querySelector(e.submitButtonSelector),y=v.querySelector(".popup__close-button"),b=document.querySelector("#avatar-link-input"),h=document.querySelector(".profile__avatar"),S=document.querySelector(".profile__add-button"),q=document.querySelector("#cardUpload").closest(".popup"),E=(q.querySelector(".popup__close-button"),document.querySelector(".profile__edit-button")),k=document.querySelector("#profileEdit").closest(".popup"),L=(k.querySelector(".popup__close-button"),document.querySelector("#profileEdit")),C=L.querySelector("#name-input"),g=document.querySelector(".profile__name"),x=L.querySelector("#about-input"),j=document.querySelector(".profile__career"),P=L.querySelector(e.submitButtonSelector);function T(t){t.classList.add("popup_opened"),document.addEventListener("keydown",z),document.addEventListener("click",A)}function B(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",z),document.removeEventListener("click",A)}function z(t){"Escape"===t.key&&B(document.querySelector(".popup_opened"))}function A(t){t.target.classList.contains("popup_opened")&&B(t.target)}function N(){m.classList.toggle("profile__avatar-edit_active")}function O(t,e){e.textContent=!0===t?"Сохренение...":"Сохранить"}function D(t,e){var n=u.querySelector(".card").cloneNode(!0),a=n.querySelector(".card__image"),i=n.querySelector(".card__text");a.src=t.link,a.alt=t.name,i.textContent=t.name;var s=n.querySelector(".card__delete-button");e===t.owner._id?s.addEventListener("click",(function(e){(function(t){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-14/cards/".concat(t._id),{method:"DELETE",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767"}})})(t).then((function(t){t.ok&&e.target.closest(".card").remove()}))})):s.classList.add("card__delete-button_disabled");var l=n.querySelector(".like-button"),d=n.querySelector(".like__count");d.textContent=Number(t.likes.length),l.addEventListener("click",(function(e){e.target.classList.contains("like-button_active")?function(t){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-14/cards/likes/".concat(t._id),{method:"DELETE",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767"}})}(t).then((function(t){t.ok&&(e.target.classList.remove("like-button_active"),d.textContent=Number(d.textContent)-1)})):function(t){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-14/cards/likes/".concat(t._id),{method:"PUT",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767"}})}(t).then((function(t){t.ok&&(e.target.classList.add("like-button_active"),d.textContent=Number(d.textContent)+1)}))})),t.likes.forEach((function(t){t._id===e&&l.classList.add("like-button_active")}));var p=n.querySelector(".card__image");return p.addEventListener("click",(function(t){r.src=p.src,r.alt=p.alt,c.textContent=p.alt,T(o)})),n}function w(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];o?e.prepend(t):e.append(t)}var J=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o.inactiveButtonClass),e.disabled=!1):(e.classList.add(o.inactiveButtonClass),e.disabled=!0)};function M(t){t.classList.add(e.inactiveButtonClass),t.disabled=!0}var U="";fetch("".concat("https://mesto.nomoreparties.co/v1/plus-cohort-14","/users/me"),{method:"GET",headers:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767"}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){return g.textContent=t.name,j.textContent=t.about,h.style.backgroundImage="url(".concat(t.avatar,")"),U="".concat(t._id)})),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-14/cards",{method:"GET",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){w(D(t,U),a,!1)}))})),g.textContent="".concat(C.value),j.textContent="".concat(x.value),S.addEventListener("click",(function(){T(q)})),E.addEventListener("click",(function(){x.value=j.textContent,C.value=g.textContent,T(k)})),L.addEventListener("submit",(function(t){t.preventDefault(),O(!0,P),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-14/users/me",{method:"PATCH",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(C.value),about:"".concat(x.value)})}).then((function(t){return t.ok?(g.textContent="".concat(C.value),j.textContent="".concat(x.value),B(k),t.json()):Promise.reject(t.status)})).finally((function(){return O(!1,P)}))})),n.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return B(e)}))})),i.addEventListener("submit",(function(t){(function(t){t.preventDefault(),O(!0,p),fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{method:"POST",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(s.value),link:"".concat(l.value)})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(e){w(D(e,U),a,!0),B(d),t.target.reset()})).finally((function(){return O(!1,p)}))})(t),M(p)})),y.addEventListener("click",(function(){B(v)})),f.addEventListener("mouseover",N),f.addEventListener("mouseout",N),f.addEventListener("click",(function(){T(v)})),document.querySelector("#change-avatar").addEventListener("submit",(function(t){(function(t){t.preventDefault(),O(!0,_),fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me/avatar",{method:"PATCH",headers:{authorization:"bff12cd7-d8f7-418f-b6b2-2cd8334e6767","Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(b.value)})}).then((function(e){if(!e.ok)return Promise.reject(e.status);h.style.backgroundImage="url(".concat(b.value,")"),t.target.reset(),B(v)})).finally((function(){return O(!1,_)}))})(t),M(_)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);J(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)}(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(t,e,e.validationMessage,o)}(t,r,e),J(o,n,e)}))}))}(e,t)}))}(e)})();